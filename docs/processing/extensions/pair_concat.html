

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extension: Pair concatenation &mdash; Bioinformatic Methods for Biodiversity Metabarcoding  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/js/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4. Data concatenation" href="../data_concat.html" />
    <link rel="prev" title="3. Pair merging" href="../pair_merging.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Bioinformatic Methods for Biodiversity Metabarcoding
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data.html">Example data</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../readprocessing.html">A: Read processing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../fastq.html">Fundamentals: FASTQ files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../demultiplexing.html">1. Demultiplexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../primer_removal.html">2. Primer removal</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../pair_merging.html">3. Pair merging</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Extension: Pair concatenation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../data_concat.html">4. Data concatenation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../filtering.html">B: Filtering amplicons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asv_otu_readmap.html">C: ASVs, OTUs and read mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building_otu_phylogeny.html">D: Building OTU phylogeny</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../otuid.html">E: Identifying OTU sequences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contactus.html">Contact us</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Bioinformatic Methods for Biodiversity Metabarcoding</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../readprocessing.html">A: Read processing</a> &raquo;</li>
        
          <li><a href="../pair_merging.html">3. Pair merging</a> &raquo;</li>
        
      <li>Extension: Pair concatenation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/processing/extensions/pair_concat.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="extension-pair-concatenation">
<span id="pair-concatenation"></span><h1>Extension: Pair concatenation<a class="headerlink" href="#extension-pair-concatenation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>What happens if our fragment length is so much longer than our read length that it doesn’t overlap? For example, if we had sequenced these fragments using a 2x150bp metric instead of 2x300bp? Let’s simulate it.</p>
<div class="admonition-data-and-software admonition">
<p class="admonition-title">Data and software</p>
<p>This extension follows on from the tutorial on <a class="reference internal" href="../pair_merging.html#pair-merging"><span class="std std-ref">pair merging</span></a> using the same starting data and software.</p>
<p>We will also use <a class="reference internal" href="../../gettingstarted/setup/installing_software.html#cutadapt"><span class="std std-ref">cutadapt</span></a> and <a class="reference internal" href="../../gettingstarted/setup/installing_software.html#pairfq"><span class="std std-ref">pairfq</span></a>.</p>
</div>
</div>
<div class="section" id="simulation">
<h2>Simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">¶</a></h2>
<p>We will use the same starting data as from the <a class="reference internal" href="../pair_merging.html#pair-merging"><span class="std std-ref">pair merging</span></a> tutorial; that is, a set of paired FASTQ files, one pair per sample. We can apply <strong>cutadapt</strong> to remove 150bp from the 3’ end of each read for a pair of files (see the <a class="reference internal" href="../demultiplexing.html#demultiplexing"><span class="std std-ref">demultiplexing</span></a> and/or <a class="reference internal" href="../primer_removal.html#primer-removal"><span class="std std-ref">primer removal</span></a> tutorials for more about <strong>cutadapt</strong>). First, create a folder for this experiment (mine is called <code class="docutils literal notranslate"><span class="pre">trimmed_150</span></code>). Next, run the following commands, selecting the file pair from a single sample as the inputs.</p>
<pre class="literal-block">cutadapt -u -150 -o <span class="var">trimmed_150/output_R1.fastq</span> <span class="var">input_R1.fastq</span>
cutadapt -u -150 -o <span class="var">trimmed_150/output_R2.fastq</span> <span class="var">input_R2.fastq</span></pre>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<ul class="simple">
<li><p>Now try running PEAR on these two files using the commands from the <a class="reference internal" href="../pair_merging.html#pair-merging"><span class="std std-ref">previous tutorial</span></a></p></li>
</ul>
</div>
<p>We can’t merge them, because there’s nothing left that overlaps. So instead we have to perform concatenation - stitching the forward and reverse reads together. This achieves the same aim, converting into a single sequence rather than two independent reads.</p>
<p>The sequencer has introduced some length variation - some reads have recovered a little more data than others. <strong>PEAR</strong> took care of this automatically when it was forming a single read using the overlap, but concatenation is more basic. With non-overlapping data we need to concatenate like with like so that we generate a consistent (pseudo-)region of DNA. Otherwise we would generate spurious insertions/deletions when comparing our sequences.</p>
<p>In most cases, we would trim or discard reads such that the forward and reverse reads were each a fixed length, and then stitch each mate pair together to form a pseudo-locus. While there’s really a missing section of DNA in the middle, we have summarised our molecular information into a single fragment that is perfectly usable for many metabarcoding applications.</p>
<p>Let’s review the length distribution of our sequences to select a fixed length for each direction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sed -n &#39;2~4p&#39; ​in.fastq​ | while read l; do echo ${#l} ; done | sort | uniq -c
</pre></div>
</div>
<p>Generally, we would select something around the central tendency, to retain as much data as possible.</p>
<p><span class="guilabel">Select a length for each read direction. It does not need to be the same value.</span></p>
<p>We know the end with the primer is the accurate end, so we trim bases from the other end. We use <strong>cutadapt</strong> for this. The <code class="docutils literal notranslate"><span class="pre">-l</span></code> argument trims reads down to a value, and the <code class="docutils literal notranslate"><span class="pre">-m</span></code> argument specifies a minimum length. Set them as the same value, and then run the following command on each of your simulated short read files.</p>
<pre class="literal-block">cutadapt -l <span class="var">N</span> -m <span class="var">N</span> -o <span class="var">output.fastq</span> <span class="var">input.fastq</span></pre>
</div>
<div class="section" id="re-pairing-mates">
<h2>Re-pairing mates<a class="headerlink" href="#re-pairing-mates" title="Permalink to this headline">¶</a></h2>
<p><strong>Cutadapt</strong> removed short reads without removing their mates. We can’t concatenate these files yet, because they have uneven numbers of sequences. This gives us the opportunity to test using a tool for mate-pairing - i.e. making sure two files are “in sync”. This is performed by throwing away any reads in either the forward or reverse file that do not have a mate pair in the other file. We will use <strong>pairfq</strong> for this.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Run <strong>pairfq</strong> on your simulated short read files, as follows. There are a lot of names to replace in this command!</p>
<pre class="literal-block">pairfq makepairs -f <span class="var">input_R1.fastq</span> -r <span class="var">input_R2.fastq</span> -fp <span class="var">output_R1.fastq</span> -rp <span class="var">output_R2.fastq</span> -fs <span class="var">output_R1_unpaired.fastq -rs</span> <span class="var">​output_R2_unpaired.fastq</span></pre>
<p>As always, use <code class="docutils literal notranslate"><span class="pre">grep</span></code> to check output file read numbers.</p>
</div>
</div>
<div class="section" id="stitching">
<h2>Stitching<a class="headerlink" href="#stitching" title="Permalink to this headline">¶</a></h2>
<p><strong>PEAR</strong> can stitch our mate pairs, and it reverse-complements the reverse reads for us.</p>
<pre class="literal-block">pear -i -f <span class="var">input_R1.fastq</span> -r <span class="var">input_R2.fastq</span> -o <span class="var">outname</span></pre>
<p>This won’t work! The problem is thatThen run <strong>PEAR</strong> again to concatenate the mate pairs, as in the previous command but now using the outputs from <strong>pairfq</strong>.</p>
<blockquote>
<div><ul class="simple">
<li><p>Are these concatenated sequences as reliable as our merged sequences? Why not?</p></li>
</ul>
</div></blockquote>
<div class="admonition-note admonition">
<p class="admonition-title">Note</p>
<p>If we have reads that are just too short to overlap, or too short to overlap well (e.g. &lt; 10-20bp overlap), one option is to edit the reads such that the small missing region is padded with Ns. Reads that do overlap are merged if possible, or trimmed to be consecutive. Reads that are too short have N added to go up to the right length, and then the reads are stitched. This only applies to regions where we can be reasonably confident of a consistent, predictable length between primers. One issue would be the selection of an OTU delimitation method that took account of the ambiguous regions, otherwise the sequences would in general be more similar to one another than expected. For this reason this would only usually be done for projects with a small missing region.</p>
</div>
</div>
<div class="section" id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>If you have lots of time and you’re very interested, you could at this point run the simulated trimming, re-pairing and stitching on the rest of the files, creating a parallel dataset of concatenated short reads. Later, after completing sections A, B and C you could then come back to these and work through the rest of the tutorials. Compare how these sequences behave in the future steps, particularly <a class="reference internal" href="../../filtering/chimera_filtering.html#chimera"><span class="std std-ref">chimera filtering</span></a> and <a class="reference internal" href="../../asv_otu_readmap/otudelim.html#otu-delim"><span class="std std-ref">OTU delimitation</span></a>.</p>
<p>Alternatively, we’d suggest deleting or archiving the files created in this step, to avoid clutting up your working directories, then proceeding with the next tutorial, <a class="reference internal" href="../data_concat.html#data-concat"><span class="std std-ref">4. Data concatenation</span></a>, which uses the merged files from the <a class="reference internal" href="../pair_merging.html#pair-merging"><span class="std std-ref">3. Pair merging</span></a> tutorial.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../data_concat.html" class="btn btn-neutral float-right" title="4. Data concatenation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../pair_merging.html" class="btn btn-neutral float-left" title="3. Pair merging" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, The Vogler Lab

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
    <p><br>Creedy, Vogler & Penlington, Natural History Museum London, Bioinformatic Methods for Biodiversity Metabarcoding. This site is a a deliverable of the iBioGen consortium funded by EU grant agreement No 810729, the content of this site is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank">Creative Commons Attribution ShareAlike 4.0 License</a></p>


</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>