

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extension: Pair concatenation &mdash; Analysis of Metagenetic data for Macroecology  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/customcss/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/js/custom.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4) Data concatenation" href="../data_concat.html" />
    <link rel="prev" title="3) Pair merging" href="../pair_merging.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Analysis of Metagenetic data for Macroecology
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../notes.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linuxintro.html">Command line bioinformatics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../readprocessing.html">Read processing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../fastq.html">Fundamentals: FASTQ files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../demultiplexing.html">1. Demultiplexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../primer_removal.html">2) Primer removal</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../pair_merging.html">3) Pair merging</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Extension: Pair concatenation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../data_concat.html">4) Data concatenation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../filtering.html">Filtering Amplicon Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../otudelim.html">OTU Delimitation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../otuid.html">Identifying OTUs and Generating Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trees.html">Building Phylogenetic Trees for Metagenetics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../placing_otus_in_trees.html">Placing OTUs in reference trees</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Analysis of Metagenetic data for Macroecology</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../readprocessing.html">Read processing</a> &raquo;</li>
        
          <li><a href="../pair_merging.html">3) Pair merging</a> &raquo;</li>
        
      <li>Extension: Pair concatenation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/processing/extensions/pair_concat.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="extension-pair-concatenation">
<span id="pair-concatenation"></span><h1>Extension: Pair concatenation<a class="headerlink" href="#extension-pair-concatenation" title="Permalink to this headline">¶</a></h1>
<p>What happens if our fragment length is so much longer than our read length that it doesn’t overlap? For example, if we had sequenced these fragments using a 2x150bp metric instead of 2x300bp? Let’s simulate it.</p>
<p>Using the output from primer trimming, we can apply cutadapt to remove 150bp from the 3’ end of each read for a pair of files. First create a folder for this experiment (mine is called trimmed_150), then run these commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cutadapt -u -150 -o trimmed_150/T11_R1.fastq trimmed/T11_R1.fastq
$ cutadapt -u -150 -o trimmed_150/T11_R2.fastq trimmed/T11_R2.fastq
</pre></div>
</div>
<ul class="simple">
<li><p>Try running PEAR on these two files.</p></li>
</ul>
<p>We obviously can’t merge them, because there’s nothing left that overlaps. So instead we have to perform concatenation - stitching the forward and reverse reads together. This achieves the same aim as PEAR, converting into a single sequence rather than two independent reads.</p>
<p>The sequencer has introduced some length variation - some reads have recovered a little more data than others. PEAR took care of this automatically when it was forming a single read using the overlap, but concatenation is more basic. With non-overlapping data we need to concatenate like with like so that we generate a consistent (pseudo-)region of DNA. Otherwise we would generate spurious insertions/deletions when comparing our sequences.</p>
<p>In most cases, we would trim or discard reads such that the forward and reverse reads were each a fixed length, and then stitch each mate pair together to form a pseudo-locus. While there’s really a missing section of DNA in the middle, we have summarised our molecular information into a single fragment that is perfectly usable for many metabarcoding applications.</p>
<p>Let’s review the length distribution of our sequences to select a fixed length for each direction:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sed -n <span class="s1">&#39;2~4p&#39;</span> ​in.fastq​ <span class="p">|</span> <span class="k">while</span> <span class="nb">read</span> l<span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> <span class="si">${#</span><span class="nv">l</span><span class="si">}</span> <span class="p">;</span> <span class="k">done</span> <span class="p">|</span> sort <span class="p">|</span> uniq -c
</pre></div>
</div>
<p>Generally, we would select something around the central tendency, to retain as much data as possible.</p>
<ul class="simple">
<li><p>Select a length for each read. It does not need to be the same value.</p></li>
</ul>
<p>We know the end with the primer is the accurate end, so we trim bases from the other end. We use cutadapt for this. The -l argument trims reads down to a value, and the -m argument specifies a minimum length. Set them as the same value:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cutadapt -l ​n​ -m ​n​ -o ​out.fastq​ ​in.fastq
</pre></div>
</div>
<p>Run this on your forward and reverse read file.</p>
<p>PEAR can stitch our mate pairs, and it reverse-complements the reverse reads for us.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pear -i -f ​in_R1.fastq​ -r ​in_R2.fastq -​ o ​outname
</pre></div>
</div>
<p>Oh dear. The problem is that we removed short reads without removing their mates. This gives us the opportunity to test using a tool for mate-pairing - i.e. making sure two files are in sync. We will use <a class="reference external" href="https://github.com/sestaton/pairfq">pairfq</a> for this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pairfq makepairs -f ​in_R1.fastq -r ​in_R2.fastq -fp ​out_R1.fastq -rp ​out_R2.fastq -fs ​out_R1_unpaired.fastq​ -rs ​out_R2_unpaired.fastq
</pre></div>
</div>
<p>As always, use grep to check out file read numbers. Then run pear again to create the mate pairs.</p>
<ul class="simple">
<li><p>Are these concatenated sequences as reliable as our merged sequences? Why not?</p></li>
</ul>
<p>You could at this point create a parallel dataset of concatenated short reads. Later, you can come back to these and work through the rest of the pipeline. Compare how these sequences behave in the future steps, particularly chimera filtering and OTU delimitation.</p>
<p>As an aside, if we have reads that are just too short to overlap, or too short to overlap well (e.g. &lt; 10-20bp overlap), one option is to edit the reads such that the small missing region is padded with Ns. Reads that do overlap are merged if possible, or trimmed to be consecutive. Reads that are too short have N added to go up to the right length, and then the reads are stitched. This only applies to regions where we can be reasonably confident of a consistent, predictable length between primers. One issue would be the selection of an OTU delimitation method that took account of the ambiguous regions, otherwise the sequences would in general be more similar to one another than expected. For this reason this would only usually be done for projects with a small missing region.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../data_concat.html" class="btn btn-neutral float-right" title="4) Data concatenation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../pair_merging.html" class="btn btn-neutral float-left" title="3) Pair merging" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, The Vogler Lab

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>